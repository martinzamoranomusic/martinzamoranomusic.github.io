<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shows | Martín Zamorano</title>
  <link rel="stylesheet" href="assets/style.css" />
  <style>
    body {
      background-image: url('assets/images/bg_improvisation.jpg');
      background-size: cover; background-attachment: fixed;
      background-position: center top; background-repeat: no-repeat;
    }
    body::before {
      content: ''; position: fixed; inset: 0;
      background: rgba(11,11,11,.88); z-index: 0; pointer-events: none;
    }
    header { position: relative; z-index: 100; }
    main.page-content, footer { position: relative; z-index: 1; }
  </style>
</head>
<body>
  <header></header>

  <main class="page-content">
    <h1 data-i18n="shows.upcoming">Upcoming Shows</h1>
    <div id="shows-upcoming"></div>
    <div id="shows-past"></div>
  </main>

  <footer>
    <nav class="footer-nav">
      <a href="impressum.html">Impressum</a>
      <a href="datenschutz.html">Datenschutz</a>
    </nav>
    <p class="footer-copy" data-i18n="site.footer.copy">&copy; 2026 Martín Zamorano</p>
  </footer>

  <script src="assets/i18n/de.js"></script>
  <script src="assets/i18n/en.js"></script>
  <script src="assets/i18n/es.js"></script>
  <script src="assets/shows-data.js"></script>
  <script src="assets/nav.js"></script>
  <script>
    (function () {
      function parseDate(str) {
        var p = str.split('.');
        return new Date(+p[2], +p[1] - 1, +p[0]);
      }

      function venueHTML(show) {
        return show.url
          ? '<a href="' + show.url + '" target="_blank" rel="noopener">' + show.venue + '</a>'
          : show.venue;
      }

      function buildTable(shows, past) {
        var rows = shows.map(function (s) {
          return '<tr>'
            + '<td class="show-date">'    + s.date              + '</td>'
            + '<td class="show-venue">'   + venueHTML(s)        + '</td>'
            + '<td class="show-city">'    + s.city              + '</td>'
            + '<td class="show-project">' + s.project           + '</td>'
            + '</tr>';
        }).join('');
        return '<table class="shows-table' + (past ? ' shows-table--past' : '') + '">'
          + '<tbody>' + rows + '</tbody></table>';
      }

      var today = new Date();
      today.setHours(0, 0, 0, 0);

      var activeLang = (function () {
        try { return localStorage.getItem('mz_lang') || 'de'; } catch (e) { return 'de'; }
      })();
      var dicts = { de: window.I18N_DE, en: window.I18N_EN, es: window.I18N_ES };
      var d = dicts[activeLang] || window.I18N_DE;

      var upcoming = [], past = [];
      (window.SHOWS_DATA || []).forEach(function (s) {
        (parseDate(s.date) >= today ? upcoming : past).push(s);
      });

      upcoming.sort(function (a, b) { return parseDate(a.date) - parseDate(b.date); });
      past.sort(function (a, b) { return parseDate(b.date) - parseDate(a.date); });

      var upcomingEl = document.getElementById('shows-upcoming');
      var pastEl     = document.getElementById('shows-past');

      if (upcoming.length) {
        upcomingEl.innerHTML =  buildTable(upcoming, false);
      } else {
        upcomingEl.innerHTML = '<p class="home-shows-empty">' + (d['home.shows.empty'] || 'Keine bevorstehenden Shows.') + '</p>';
      }

      if (past.length) {
        pastEl.innerHTML = '<h2>' + (d['shows.past'] || 'Past Shows') + '</h2>' + buildTable(past, true);
      }
    })();
  </script>
</body>
</html>
